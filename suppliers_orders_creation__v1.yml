openapi: 3.0.0
info:
  version: "1"
  title: "SuppliersOrdersCreation"
servers:
  - url: http://suppliers/openapi/SuppliersOrdersCreation/v1
tags:
  - name: CreateOrderTasks
paths:
  "/creationOrderTasks":
    post:
      tags:
        - CreateOrderTasks
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreationTaskInfoResult'
        '500':
          description: Internal error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CrerationTaskPostRequest'
              
  "/createOrderTasks/{id}":
    get:
      tags:
        - CreateOrderTasks
      summary: 'Get info about task state'
      parameters:
        - in: path
          name: id
          description: Id of task. Id always equals to idempotencyKey.
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 'Success'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreationTaskInfoResult'
        "500":
          description: 'Some internal error'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
components:
  schemas:
    # Basic results components
    ErrorResult:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/Message"
      description: "Message field is not required"
    Message:
      type: object
      properties:
        level:
          type: string
          enum:
            - emergency
            - alert
            - critical
            - error
            - warning
            - notice
            - info
        type:
          type: string
          enum:
            - UNDEFINED
            - ORDER_NOT_FOUND
          description: >
            You can expose this enum for all your errors
            UNDEFINED - Any undefined message type
            ORDER_NOT_FOUND - cannot find order by id
        text:
          type: string
          description: Message, that describes what went wrong
    SuccessResult:
      allOf:
        - $ref: '#/components/schemas/ErrorResult'
      type: object
      properties:
        data:
          type: object
    
    CreationTaskInfoResult:
      allOf:
        - $ref: '#/components/schemas/SuccessResult'
      type: object
      properties:
        data:
          $ref: '#/components/schemas/CreationTaskInfo'
          
    
    CrerationTaskPostRequest:
      type: object
      required:
        - payload
      properties:
        payload:
          $ref: '#/components/schemas/CrerationTaskPayload'
          
    CreationTaskInfo:
      type: object
      required:
        - id
        - stage
        - status
      properties:
        id:
          type: string
          description: Always equals to idempotencyKey
          example: '12345'
        stage:
          $ref: '#/components/schemas/Stage'
        status:
          $ref: '#/components/schemas/Status'
        payload:
          $ref: '#/components/schemas/CrerationTaskPayload'
        result:
          $ref: '#/components/schemas/CreationTaskResult'
    
    Stage:
      type: object
      required:
        - stage
        - all
      properties:
        stage:
          type: string
          description: 'Current stage'
          example: 'creating'
        all:
          type: array
          description: 'All possible stages'
          items:
            type: string
          example: [ 'creating', 'done' ]
    
    Status:
      type: object
      required:
        - state
        - all
      properties:
        state:
          type: string
          description: 'Current state'
          example: 'pending'
        all:
          type: array
          description: 'All possible states'
          items:
            type: string
          example: [ 'pending', 'in_progress', 'fulfilled', 'rejected' ]
          
    CrerationTaskPayload:
      type: object
      required:
        - idempotencyKey
        - supplierCode
        - shippingMethodName
        - items
      properties:
        idempotencyKey:
          type: string
          description: An idempotency key is a unique value generated by the client which the server uses to recognize subsequent retries of the same request. How you create unique keys is up to you.
        supplierCode:
          type: string
          description: Supplier code
        shippingMethodName:
          type: string
          description: >
            Supplier shipping method name
            Pickup - for pickup of orders. In this case, you do not need to define a recipient, but a warehouse is required for each item.
        receiver:
          $ref: '#/components/schemas/Customer'
        items:
          type: array
          description: List of items to order
          items:
            $ref: '#/components/schemas/Item'
            
    CreationTaskResult:
      allOf:
        - $ref: '#/components/schemas/SuccessResult'
      type: object
      properties:
        data:
          $ref: '#/components/schemas/OrderNumber'
          
    OrderNumber:
      type: object
      properties:
        orderId:
          type: string
          description: id of created order
          example: 'Autodist | AU431'
          
    Item:
      type: object
      required:
        - rid
        - quantity
      properties:
        rid:
          type: string
          description: Rollun Id
          example: VW6A4
        quantity:
          type: integer
          description: Quantity of products
          example: 2
        warehouse:
          type: string
          nullable: true
          description: >
            The name of the warehouse from where you want to send the goods. Specific for each supplier.
            If no warehouse has been specified, then the supplier can choose the appropriate one, depending on its distance to the client and the availability of items.
            If a warehouse is specified, then the supplier must send from it, or report an error, why he cannot do this
            Required for pickup orders.
            TuckerRocky - ['TX']
            PartsUnlimited - ['NC']
    Customer:
      type: object
      required:
        - name
        - address
      properties:
        name:
          type: string
          description: Full name
          example: Shawn Weisweaver
        phone:
          type: string
          nullable: true
          description: Phone number to reach the person
          example: "415-123-4567"
        email:
          type: string
          nullable: true
          description: Email address to reach the person
          example: "test@mail.loc"
        address:
          $ref: "#/components/schemas/Address"
    Address:
      type: object
      required:
        - country
        - state
        - city
        - postalCode
        - address1
      properties:
        country:
          type: string
          description: "Country code"
        state:
          type: string
          description: US state code
          example: CA
        city:
          type: string
          description: Full city name
          example: San Francisco
        postalCode:
          type: string
          description: ZIP or postal code
          example: "94104"
        address1:
          type: string
          description: First line of the address
          example: "417 Montgomery St"
        address2:
          type: string
          nullable: true
          description: Second line of the address
          example: "Floor 5"