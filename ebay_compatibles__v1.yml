openapi: 3.0.0
info:
  version: "1"
  title: EbayCompatibles
servers:
  - url: http://ebay-p-inventory/openapi/EbayCompatibles/v1
  - url: http://ebay-r-inventory/openapi/EbayCompatibles/v1
  - url: http://l.ebay-inventory/openapi/EbayCompatibles/v1
  - url: http://localhost:8001/openapi/EbayCompatibles/v1
  - url: http://localhost:8082/openapi/EbayCompatibles/v1
tags:
  - name: CatalogCompatibles
paths:
  /catalog/compatibles:
    get:
      operationId: getCompatibles
      tags:
        - CatalogCompatibles
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
          description: Default 100, Max 100
        - name: offset
          in: query
          schema:
            type: integer
          description: Default 0
        - name: sortField
          in: query
          schema:
            type: string
            enum:
              - "updatedCompAt"
          description: In this moment only one field is enabled - "updatedCompAt". Default value "updatedCompAt".
        - name: sortDirection
          in: query
          schema:
            type: string
            enum:
              - "asc"
              - "desc"
          description: Default value "asc"
        - name: compatibleFields
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
          example: epid,make
          description: Field "epid" is required. Default null
      responses:
        201:
          description: Item collection
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompatiblesCollectionResponse'
        "500":
          description: "Internal error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /catalog/compatibles/{rid}:
    get:
      tags:
        - CatalogCompatibles
      parameters:
        - name: rid
          in: path
          required: true
          schema:
            type: string
      responses:
        201:
          description: One item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompatiblesResponse'
        "500":
          description: "Internal error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      tags:
        - CatalogCompatibles
      parameters:
        - name: rid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCompatiblesRequest'
      responses:
        '201':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompatiblesResponse'
        "500":
          description: "Internal error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    SuccessResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      properties:
        data:
          type: object
    ErrorResponse:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
    Message:
      type: object
      required:
        - level
        - text
      properties:
        level:
          type: string
          description: 'Message level  (like in a logger)'
          example: 'error'
        text:
          type: string
          description: 'Message text'
          example: 'Something wrong.'
        context:
          type: array
          description: 'Message context (like in a logger)'
          items:
            type: string
    PaginatedMetaResponse:
      type: object
      properties:
        meta:
          $ref: "#/components/schemas/PaginatedMeta"
    PaginatedMeta:
      type: object
      properties:
        offset:
          type: integer
        limit:
          type: integer
        total:
          type: integer
    CollectionResponse:
      type: object
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - $ref: "#/components/schemas/PaginatedMetaResponse"
    CompatiblesCollectionResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/CollectionResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/CompatibleProductOutput'
    CompatiblesResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
      properties:
        data:
          $ref: '#/components/schemas/CompatibleProductOutput'
    CreateCompatiblesRequest:
      type: object
      required:
        - rid
        - compatibles
      properties:
        rid:
          type: string
        compatibles:
          type: array
          items:
            $ref: '#/components/schemas/CompatibleInput'
    UpdateCompatiblesRequest:
      type: object
      required:
        - compatibles
      properties:
        compatibles:
          type: array
          items:
            $ref: '#/components/schemas/CompatibleInput'
    Compatible:
      type: object
      required:
        - epid
      properties:
        epid:
          type: string
        make:
          type: string
        model:
          type: string
        year:
          type: integer
          format: 'yyyy'
        submodel:
          type: string
          nullable: true
    CompatibleInput:
      type: object
      allOf:
        - $ref: '#/components/schemas/Compatible'
      required:
        - make
        - model
        - year
    CompatibleProductOutput:
      type: object
      properties:
        rid:
          type: string
        updatedCompAt:
          type: string
          format: date-time
          nullable: true
        compatibles:
          type: array
          items:
            $ref: '#/components/schemas/Compatible'
    CompatibleOutput:
      type: object
      allOf:
        - $ref: '#/components/schemas/Compatible'
      properties:
        updatedAt:
          type: string
          format: date-time
